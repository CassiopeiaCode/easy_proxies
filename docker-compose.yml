services:
  easy-proxies:
    image: ghcr.io/jasonwong1991/easy_proxies:latest
    container_name: easy-proxies
    restart: unless-stopped
    # 方式一：使用主机网络模式（推荐，支持端口自动重分配）
    network_mode: host
    # 方式二：手动映射端口（注释掉 network_mode，启用下面的 ports）
    # ports:
    #   # Pool 模式入口（pool/hybrid 模式使用）
    #   - "2323:2323"
    #   # Sticky 模式入口（启用 sticky.enabled 时使用）
    #   - "2324:2324"
    #   # Web 监控面板
    #   - "9091:9091"
    #   # Multi-port 端口范围（multi-port/hybrid 模式使用，根据节点数量调整）
    #   - "24000-24200:24000-24200"
    #
    # 支持的运行模式（在 config.yaml 中配置）：
    #   - pool: 单端口代理池，所有节点共享 2323 端口
    #   - multi-port: 多端口模式，每个节点独立端口
    #   - hybrid: 混合模式，同时启用 pool (2323) + multi-port (24000+)
    #   - sticky: 可选粘性入口，占用独立端口（默认 2324）
    #
    # hybrid 模式说明：
    #   - 代理池入口：http://0.0.0.0:2323（自动负载均衡）
    #   - 粘性入口：http://0.0.0.0:2324（按配置时间轮换或不健康立即切换）
    #   - 独立节点入口：http://0.0.0.0:24000, 24001, ...（直连特定节点）
    #   - 节点状态在多入口间共享（健康度/活跃连接统计同步）
    #   - 端口冲突时自动重分配到下一个可用端口
    volumes:
      # 配置文件需要可写权限以支持 WebUI 设置保存
      # 如遇权限问题，请在宿主机执行: chmod 666 config.yaml nodes.txt easy_proxies.db
      - ./config.yaml:/etc/easy-proxies/config.yaml
      - ./nodes.txt:/etc/easy-proxies/nodes.txt
      # SQLite 数据库持久化（与 config.yaml 同目录；默认路径 /etc/easy-proxies/easy_proxies.db）
      - ./easy_proxies.db:/etc/easy-proxies/easy_proxies.db
